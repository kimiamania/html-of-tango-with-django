<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  
<!-- Mirrored from www.tangowithdjango.com/book/chapters/models_templates.html by HTTrack Website Copier/3.x [XR&CO'2008], Tue, 29 Oct 2013 17:08:05 GMT -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>6. Models, Templates and Views &mdash; How to Tango with Django</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/twd.ico"/>
    <link rel="top" title="How to Tango with Django" href="../index-2.html" />
    <link rel="next" title="7. Fun with Forms" href="forms.html" />
    <link rel="prev" title="5. Models and Databases" href="models.html" />
 <style type="text/css">
	img{
	    width: 85%; /* you can use % */
	    height: auto;
	}
	
	table {
		margin: auto;
	}
	
	p.caption {
		font-size: 10pt;
		font-style: italic;
	}
 </style>
 <script type="text/javascript">

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','../../../www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44397330-1', 'tangowithdjango.com');
  ga('send', 'pageview');
     

  </script>      

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        
        <li class="right" >
          <a href="forms.html" title="7. Fun with Forms"
             accesskey="N">next</a>
          </li>
		
        <li class="right" >
          <a href="models.html" title="5. Models and Databases"
             accesskey="P">previous</a>
          </li>
		
        <li><a href="../index-2.html">How to Tango with Django</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index-2.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">6. Models, Templates and Views</a><ul>
<li><a class="reference internal" href="#basic-workflow-data-driven-pages">6.1. Basic Workflow: Data Driven Pages</a></li>
<li><a class="reference internal" href="#showing-categories-on-rango-s-homepage">6.2. Showing Categories on Rango&#8217;s Homepage</a><ul>
<li><a class="reference internal" href="#importing-required-models">6.2.1. Importing Required Models</a></li>
<li><a class="reference internal" href="#modifying-the-index-view">6.2.2. Modifying the Index View</a></li>
<li><a class="reference internal" href="#modifying-the-index-template">6.2.3. Modifying the Index Template</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-a-details-page">6.3. Creating a Details Page</a><ul>
<li><a class="reference internal" href="#url-design-and-mapping">6.3.1. URL Design and Mapping</a></li>
<li><a class="reference internal" href="#category-page-workflow">6.3.2. Category Page Workflow</a></li>
<li><a class="reference internal" href="#category-view">6.3.3. Category View</a></li>
<li><a class="reference internal" href="#category-template">6.3.4. Category Template</a></li>
<li><a class="reference internal" href="#parameterised-url-mapping">6.3.5. Parameterised URL Mapping</a></li>
<li><a class="reference internal" href="#modifying-the-index-view-and-template">6.3.6. Modifying the Index View and Template</a></li>
<li><a class="reference internal" href="#demo">6.3.7. Demo</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercises">6.4. Exercises</a><ul>
<li><a class="reference internal" href="#hints">6.4.1. Hints</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="models.html"
                        title="previous chapter">5. Models and Databases</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="forms.html"
                        title="next chapter">7. Fun with Forms</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/chapters/models_templates.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="http://www.tangowithdjango.com/book/search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="models-templates-and-views">
<span id="model-using-label"></span><h1>6. Models, Templates and Views<a class="headerlink" href="#models-templates-and-views" title="Permalink to this headline">¶</a></h1>
<p>Now that we have our models set up and populated with some data, we can now start putting things together. We&#8217;ll be figuring out how to source data from our models in our views, and how to present this data within our templates.</p>
<div class="section" id="basic-workflow-data-driven-pages">
<h2>6.1. Basic Workflow: Data Driven Pages<a class="headerlink" href="#basic-workflow-data-driven-pages" title="Permalink to this headline">¶</a></h2>
<p>There are five main steps that you must undertake to create a data driven webpage in Django.</p>
<ol class="arabic simple">
<li>First, import the models you wish to use into your application&#8217;s <tt class="docutils literal"><span class="pre">views.py</span></tt> file.</li>
<li>Within the view you wish to use, query the model to get the data you want to present.</li>
<li>Pass the results from your model into the template&#8217;s context.</li>
<li>Setup your template to present the data to the user in whatever way you wish.</li>
<li>If you have not done so already, map a URL to your view.</li>
</ol>
<p>These steps highlight how Django&#8217;s framework separates the concerns between models, views and templates.</p>
</div>
<div class="section" id="showing-categories-on-rango-s-homepage">
<h2>6.2. Showing Categories on Rango&#8217;s Homepage<a class="headerlink" href="#showing-categories-on-rango-s-homepage" title="Permalink to this headline">¶</a></h2>
<p>One of the requirements regarding the main pages was to show the top five rango&#8217;ed categories.</p>
<div class="section" id="importing-required-models">
<h3>6.2.1. Importing Required Models<a class="headerlink" href="#importing-required-models" title="Permalink to this headline">¶</a></h3>
<p>To fulfil this requirement, we will go through each of the above steps. First, open <tt class="docutils literal"><span class="pre">rango/views.py</span></tt> and import the <tt class="docutils literal"><span class="pre">Category</span></tt> model from Rango&#8217;s <tt class="docutils literal"><span class="pre">models.py</span></tt> file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Import the Category model</span>
<span class="kn">from</span> <span class="nn">rango.models</span> <span class="kn">import</span> <span class="n">Category</span>
</pre></div>
</div>
</div>
<div class="section" id="modifying-the-index-view">
<h3>6.2.2. Modifying the Index View<a class="headerlink" href="#modifying-the-index-view" title="Permalink to this headline">¶</a></h3>
<p>With the first step out of the way, we then want to modify our <tt class="docutils literal"><span class="pre">index()</span></tt> function. If we cast our minds back, we should remember the <tt class="docutils literal"><span class="pre">index()</span></tt> function is responsible for the main page view. Modify the function to look like the example below.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c"># Obtain the context from the HTTP request.</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="c"># Query the database for a list of ALL categories currently stored.</span>
    <span class="c"># Order the categories by no. likes in descending order.</span>
    <span class="c"># Retrieve the top 5 only - or all if less than 5.</span>
    <span class="c"># Place the list in our context_dict dictionary which will be passed to the template engine.</span>
    <span class="n">category_list</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-likes&#39;</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">context_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;categories&#39;</span><span class="p">:</span> <span class="n">category_list</span><span class="p">}</span>

    <span class="c"># Render the response and send it back!</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;rango/index.html&#39;</span><span class="p">,</span> <span class="n">context_dict</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<p>Here we have performed steps two and three in one go. First, we queried the <tt class="docutils literal"><span class="pre">Category</span></tt> model to retrieve the top five categories. Here we used the <tt class="docutils literal"><span class="pre">order_by()</span></tt> method to sort by the number of likes in descending order - hence the inclusion of the <tt class="docutils literal"><span class="pre">-</span></tt>. We then restricted this list to the first 5 <tt class="docutils literal"><span class="pre">Category</span></tt> objects in the list.</p>
<p>With the query complete, we passed a reference to the list (stored as variable <tt class="docutils literal"><span class="pre">category_list</span></tt>) to a new dictionary, <tt class="docutils literal"><span class="pre">context_dict</span></tt>. This dictionary is then passed as part of the context for the template engine in the <tt class="docutils literal"><span class="pre">render_to_response()</span></tt> call.</p>
</div>
<div class="section" id="modifying-the-index-template">
<h3>6.2.3. Modifying the Index Template<a class="headerlink" href="#modifying-the-index-template" title="Permalink to this headline">¶</a></h3>
<p>With the view updated, all that is left for us to do is update the template <tt class="docutils literal"><span class="pre">rango/index.html</span></tt>, located within your project&#8217;s <tt class="docutils literal"><span class="pre">templates</span></tt> directory. Change the HTML code of the file so that it looks like the example shown below.</p>
<div class="highlight-html"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>Rango<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>

    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;h1&gt;</span>Rango says...hello world!<span class="nt">&lt;/h1&gt;</span>

        {% if categories %}
            <span class="nt">&lt;ul&gt;</span>
                {% for category in categories %}
                <span class="nt">&lt;li&gt;</span>{{ category.name }}<span class="nt">&lt;/li&gt;</span>
                {% endfor %}
            <span class="nt">&lt;/ul&gt;</span>
        {% else %}
            <span class="nt">&lt;strong&gt;</span>No categories at present.<span class="nt">&lt;/strong&gt;</span>
        {% endif %}

        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/rango/about/&quot;</span><span class="nt">&gt;</span>About<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>Here, we make use of Django&#8217;s template language to present the data using <tt class="docutils literal"><span class="pre">if</span></tt> and <tt class="docutils literal"><span class="pre">for</span></tt> control statements. Within the <tt class="docutils literal"><span class="pre">&lt;body&gt;</span></tt> of the page, we test to see if <tt class="docutils literal"><span class="pre">categories</span></tt> - the name of the context variable containing our list - actually contains any categories (i.e. <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">categories</span> <span class="pre">%}</span></tt>).</p>
<p>If so, we proceed to construct an unordered HTML list (within the <tt class="docutils literal"><span class="pre">&lt;ul&gt;</span></tt> tags). The for loop (<tt class="docutils literal"><span class="pre">{%</span> <span class="pre">for</span> <span class="pre">category</span> <span class="pre">in</span> <span class="pre">categories</span> <span class="pre">%}</span></tt>) then iterates through the list of results, printing out each category&#8217;s name (<tt class="docutils literal"><span class="pre">{{</span> <span class="pre">category.name</span> <span class="pre">}}`)`</span> <span class="pre">within</span> <span class="pre">a</span> <span class="pre">pair</span> <span class="pre">of</span> <span class="pre">``&lt;li&gt;</span></tt> tags to indicate a list element.</p>
<p>If no categories exist, a message is displayed instead indicating so.</p>
<p>As the example shows in Django&#8217;s template language, all commands are enclosed within the tags <tt class="docutils literal"><span class="pre">{%</span></tt> and <tt class="docutils literal"><span class="pre">%}</span></tt>, while variables are referenced within <tt class="docutils literal"><span class="pre">{{</span></tt> and <tt class="docutils literal"><span class="pre">}}</span></tt> brackets.</p>
<p>If you now visit Rango&#8217;s homepage at <a class="reference external" href="http://127.0.0.1:8000/rango/">http://127.0.0.1:8000/rango/</a>, you should see a list of three categories underneath the page title just like in Figure <a class="pageref" href="#fig-rango-categories-simple">1</a>.</p>
<div class="align-center figure" id="fig-rango-categories-simple">
<img alt="../_images/rango-categories-simple.png" src="../_images/rango-categories-simple.png" />
<p class="caption">Figure 1: The Rango homepage - now dynamically generated - showing a list of categories. How exciting!</p>
</div>
</div>
</div>
<div class="section" id="creating-a-details-page">
<h2>6.3. Creating a Details Page<a class="headerlink" href="#creating-a-details-page" title="Permalink to this headline">¶</a></h2>
<p>According to Rango&#8217;s specification, we also need to show a list of pages that are associated with each category.
We have a number of challenges here to overcome. A new view must be created, which should be parameterised. We also need to create URL patterns and URL strings that encode category names.</p>
<div class="section" id="url-design-and-mapping">
<h3>6.3.1. URL Design and Mapping<a class="headerlink" href="#url-design-and-mapping" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s start by considering the URL problem. One way we could handle this problem is to use the unique ID for each category within the URL. For example, we could create URLs like <tt class="docutils literal"><span class="pre">/rango/category/1/</span></tt> or <tt class="docutils literal"><span class="pre">/rango/category/2/</span></tt>, where the numbers correspond to the categories with unique IDs 1 and 2 respectively. However, these URLs are not easily understood by humans. Although we could probably infer that the number relates to a category, how would a user know what category relates to unique IDs 1 or 2? The user wouldn&#8217;t know without trying.</p>
<p>Instead, we could just use the category name as part of the URL. <tt class="docutils literal"><span class="pre">/rango/category/Python/</span></tt> should give us a list of pages related to the Python category. This is a simple, readable and meaningful URL. If we go with this approach, we&#8217;ll have to handle categories which have multiple words, like &#8216;Other Frameworks&#8217;, etc.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Designing clean URLs is an important aspect of web design. See <a class="reference external" href="http://en.wikipedia.org/wiki/Clean_URL">Wikipedia&#8217;s article on Clean URLs</a> for more details.</p>
</div>
</div>
<div class="section" id="category-page-workflow">
<h3>6.3.2. Category Page Workflow<a class="headerlink" href="#category-page-workflow" title="Permalink to this headline">¶</a></h3>
<p>With our URLs design chosen, let&#8217;s get started. We&#8217;ll undertake the following steps.</p>
<ol class="arabic">
<li><p class="first">Import the Page model into <tt class="docutils literal"><span class="pre">rango/views.py</span></tt>.</p>
</li>
<li><dl class="first docutils">
<dt>Create a new view in <tt class="docutils literal"><span class="pre">rango/views.py</span></tt> - called <tt class="docutils literal"><span class="pre">category</span></tt> - The <tt class="docutils literal"><span class="pre">category</span></tt> view will take an additional parameter, <tt class="docutils literal"><span class="pre">category_name_url</span></tt> which will stored the encoded category name.</dt>
<dd><ul class="first last simple">
<li>We will need some help functions to encode and decode the <tt class="docutils literal"><span class="pre">category_name_url</span></tt>.</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Create a new template, <tt class="docutils literal"><span class="pre">templates/rango/category.html</span></tt>.</p>
</li>
<li><p class="first">Update Rango&#8217;s <tt class="docutils literal"><span class="pre">urlpatterns</span></tt> to map the new <tt class="docutils literal"><span class="pre">category</span></tt> view to a URL pattern in <tt class="docutils literal"><span class="pre">rango/urls.py</span></tt>.</p>
</li>
</ol>
<p>We&#8217;ll also need to update the <tt class="docutils literal"><span class="pre">index()</span></tt> view and <tt class="docutils literal"><span class="pre">index.html</span></tt> template to provide links to the category page view.</p>
</div>
<div class="section" id="category-view">
<h3>6.3.3. Category View<a class="headerlink" href="#category-view" title="Permalink to this headline">¶</a></h3>
<p>In <tt class="docutils literal"><span class="pre">rango/views.py</span></tt>, we first need to import the <tt class="docutils literal"><span class="pre">Page</span></tt> model. This means we must add the following import statement at the top of the file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">rango.models</span> <span class="kn">import</span> <span class="n">Page</span>
</pre></div>
</div>
<p>Next, we can add our new view, <tt class="docutils literal"><span class="pre">category()</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">category</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">category_name_url</span><span class="p">):</span>
    <span class="c"># Request our context from the request passed to us.</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="c"># Change underscores in the category name to spaces.</span>
    <span class="c"># URLs don&#39;t handle spaces well, so we encode them as underscores.</span>
    <span class="c"># We can then simply replace the underscores with spaces again to get the name.</span>
    <span class="n">category_name</span> <span class="o">=</span> <span class="n">category_name_url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">)</span>

    <span class="c"># Create a context dictionary which we can pass to the template rendering engine.</span>
    <span class="c"># We start by containing the name of the category passed by the user.</span>
    <span class="n">context_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;category_name&#39;</span><span class="p">:</span> <span class="n">category_name</span><span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c"># Can we find a category with the given name?</span>
        <span class="c"># If we can&#39;t, the .get() method raises a DoesNotExist exception.</span>
        <span class="c"># So the .get() method returns one model instance or raises an exception.</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">category_name</span><span class="p">)</span>

        <span class="c"># Retrieve all of the associated pages.</span>
        <span class="c"># Note that filter returns &gt;= 1 model instance.</span>
        <span class="n">pages</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">)</span>

        <span class="c"># Adds our results list to the template context under name pages.</span>
        <span class="n">context_dict</span><span class="p">[</span><span class="s">&#39;pages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pages</span>
        <span class="c"># We also add the category object from the database to the context dictionary.</span>
        <span class="c"># We&#39;ll use this in the template to verify that the category exists.</span>
        <span class="n">context_dict</span><span class="p">[</span><span class="s">&#39;category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">category</span>
    <span class="k">except</span> <span class="n">Category</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="c"># We get here if we didn&#39;t find the specified category.</span>
        <span class="c"># Don&#39;t do anything - the template displays the &quot;no category&quot; message for us.</span>
        <span class="k">pass</span>

    <span class="c"># Go render the response and return it to the client.</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;rango/category.html&#39;</span><span class="p">,</span> <span class="n">context_dict</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<p>Our new view follows the same basic steps as our <tt class="docutils literal"><span class="pre">index()</span></tt> view. We first obtain the context of the request, then build a context dictionary, render the template, and send the result back. In this case, the difference is that the context dictionary building is a little more complex. To build our context dictionary, we need to determine which category to look at by using the value passed as parameter <tt class="docutils literal"><span class="pre">category_name_url</span></tt> to the <tt class="docutils literal"><span class="pre">category()</span></tt> view function. Once we have determined which category to look for, we can pull the relevant information from the database and append the results to our context dictionary, <tt class="docutils literal"><span class="pre">context_dict</span></tt>. We&#8217;ll figure out how to get the value for <tt class="docutils literal"><span class="pre">category_name_url</span></tt> from the URL shortly.</p>
<p>You will have also seen in the <tt class="docutils literal"><span class="pre">category()</span></tt> view function we assume that the <tt class="docutils literal"><span class="pre">category_name_url</span></tt> is the category name where spaces are converted to underscores. We therefore replace all the underscores with spaces. This is unfortunately a pretty crude way to handle the decoding and encoding of the category name within the URL. As an exercise later, it&#8217;ll be your job to create two functions to encode and decode category name.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">While you can used spaces in URLs, it is considered to be unsafe to use them. Check out <a class="reference external" href="../../../www.ietf.org/rfc/rfc1738.txt">IETF Memo on URLs</a> to read more.</p>
</div>
</div>
<div class="section" id="category-template">
<h3>6.3.4. Category Template<a class="headerlink" href="#category-template" title="Permalink to this headline">¶</a></h3>
<p>Now let&#8217;s create our template for the new view.  In <tt class="docutils literal"><span class="pre">&lt;workspace&gt;/tango_with_django_project/templates/rango/</span></tt> directory, create <tt class="docutils literal"><span class="pre">category.html</span></tt>. In the new file, add the following code.</p>
<div class="highlight-html"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>Rango<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>

    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;h1&gt;</span>{{ category_name }}<span class="nt">&lt;/h1&gt;</span>
        {% if category %}
            {% if pages %}
            <span class="nt">&lt;ul&gt;</span>
                {% for page in pages %}
                <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ page.url }}&quot;</span><span class="nt">&gt;</span>{{ page.title }}<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                {% endfor %}
            <span class="nt">&lt;/ul&gt;</span>
            {% else %}
                <span class="nt">&lt;strong&gt;</span>No pages currently in category.<span class="nt">&lt;/strong&gt;</span>
            {% endif %}
        {% else %}
            The specified category {{ category_name }} does not exist!
        {% endif %}
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>The HTML code example again demonstrates how we utilise the data passed to the template via its context. We make use of the <tt class="docutils literal"><span class="pre">category_name</span></tt> variable and our <tt class="docutils literal"><span class="pre">category</span></tt> and <tt class="docutils literal"><span class="pre">pages</span></tt> objects. If <tt class="docutils literal"><span class="pre">category</span></tt> is not defined within our template context, the category was not found within the database, and a friendly error message is displayed stating this fact. If the opposite is true, we then proceed to check for <tt class="docutils literal"><span class="pre">pages</span></tt>. If <tt class="docutils literal"><span class="pre">pages</span></tt> is undefined or contains no elements, we display a message stating there are no pages present. Otherwise, the pages within the category are presented in a HTML list. For each page in the <tt class="docutils literal"><span class="pre">pages</span></tt> list, we present their <tt class="docutils literal"><span class="pre">title</span></tt> and <tt class="docutils literal"><span class="pre">url</span></tt> attributes.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This a Django template <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">%}</span></tt> statement with an object is a really neat way of determining the existence of the object within the template&#8217;s context. Try getting into the habit of performing these checks to reduce the scope for potential exceptions that could be raised within your code.</p>
</div>
</div>
<div class="section" id="parameterised-url-mapping">
<h3>6.3.5. Parameterised URL Mapping<a class="headerlink" href="#parameterised-url-mapping" title="Permalink to this headline">¶</a></h3>
<p>Now let&#8217;s have a look at how we actually pass the value of the <tt class="docutils literal"><span class="pre">category_name_url</span></tt> parameter to the <tt class="docutils literal"><span class="pre">category()</span></tt> function. To do so, we need to modify Rango&#8217;s <tt class="docutils literal"><span class="pre">urls.py</span></tt> file and update the <tt class="docutils literal"><span class="pre">urlpatterns</span></tt> tuple as follows.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;index&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^about/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">about</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;about&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^category/(?P&lt;category_name_url&gt;\w+)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;category&#39;</span><span class="p">),)</span> <span class="c"># New!</span>
</pre></div>
</div>
<p>As you can see, we have added in a rather complex entry that will invoke <tt class="docutils literal"><span class="pre">view.category()</span></tt> when the regular expression <tt class="docutils literal"><span class="pre">r'^(?P&lt;category_name_url&gt;\w+)/$'</span></tt> is matched. We set up our regular expression to look for any sequence of word characters (e.g. a-z, A-Z, _, or 0-9) before the end of the URL, or a trailing URL slash - whatever comes first. This value is then passed to the view <tt class="docutils literal"><span class="pre">views.category()</span></tt> as parameter <tt class="docutils literal"><span class="pre">category_name_url</span></tt>, the only argument after the mandatory <tt class="docutils literal"><span class="pre">request</span></tt> argument. Essentially, the name you hard-code into the regular expression is the name of the argument that Django looks for in your view&#8217;s function definition.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Regular expressions may seem horrible and confusing at first, but there are tons of resources online to help you. <a class="reference external" href="http://cheatography.com/davechild/cheat-sheets/regular-expressions/">This cheat sheet</a> provides you with an excellent resource for fixing pesky regular expression problems.</p>
</div>
</div>
<div class="section" id="modifying-the-index-view-and-template">
<h3>6.3.6. Modifying the Index View and Template<a class="headerlink" href="#modifying-the-index-view-and-template" title="Permalink to this headline">¶</a></h3>
<p>Our new view is set up and ready to go - but we need to do one more thing. Our index page view needs to be updated to provide users with a means to view the category pages that are listed. Update in the <tt class="docutils literal"><span class="pre">index()</span></tt> in <tt class="docutils literal"><span class="pre">rango/views.py</span></tt> as follows.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c"># Obtain the context from the HTTP request.</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="c"># Query for categories - add the list to our context dictionary.</span>
    <span class="n">category_list</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-likes&#39;</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">context_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;categories&#39;</span><span class="p">:</span> <span class="n">category_list</span><span class="p">}</span>

    <span class="c"># The following two lines are new.</span>
    <span class="c"># We loop through each category returned, and create a URL attribute.</span>
    <span class="c"># This attribute stores an encoded URL (e.g. spaces replaced with underscores).</span>
    <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">category_list</span><span class="p">:</span>
        <span class="n">category</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)</span>

    <span class="c"># Render the response and return to the client.</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;rango/index.html&#39;</span><span class="p">,</span> <span class="n">context_dict</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<p>As explained in the inline commentary, we take each category that the database returns, then iterate through the list of categories encoding the name to make it URL friendly. This URL friendly value is then placed as an attribute inside the <tt class="docutils literal"><span class="pre">Category</span></tt> object (i.e. we take advantage of Python&#8217;s dynamic typing to add this attribute on the fly).</p>
<p>We then pass the list of categories - <tt class="docutils literal"><span class="pre">category_list</span></tt> - to the context of the template so it can be rendered. With a <tt class="docutils literal"><span class="pre">url</span></tt> attribute now available for each category, we can update our <tt class="docutils literal"><span class="pre">index.html</span></tt> template to look like the example below.</p>
<div class="highlight-html"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>Rango<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>

    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;h1&gt;</span>Rango says..hello world!<span class="nt">&lt;/h1&gt;</span>

        {% if categories %}
            <span class="nt">&lt;ul&gt;</span>
                {% for category in categories %}
                <span class="c">&lt;!-- Following line changed to add an HTML hyperlink --&gt;</span>
                <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/rango/category/{{ category.url }}&quot;</span><span class="nt">&gt;</span>{{ category.name }}<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                {% endfor %}
            <span class="nt">&lt;/ul&gt;</span>
       {% else %}
            <span class="nt">&lt;strong&gt;</span>No categories at present.<span class="nt">&lt;/strong&gt;</span>
       {% endif %}

    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>Here we have updated each list element (<tt class="docutils literal"><span class="pre">&lt;li&gt;</span></tt>) adding a HTML hyperlink (<tt class="docutils literal"><span class="pre">&lt;a&gt;</span></tt>). The hyperlink has an <tt class="docutils literal"><span class="pre">href</span></tt> attribute, which we use to specify the target URL defined by <tt class="docutils literal"><span class="pre">{{</span> <span class="pre">category.url</span> <span class="pre">}}</span></tt>.</p>
</div>
<div class="section" id="demo">
<h3>6.3.7. Demo<a class="headerlink" href="#demo" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s try everything out now by visiting the Rango&#8217;s homepage. You should see your homepage listing all the categories. The categories should now be clickable links. Clicking on <tt class="docutils literal"><span class="pre">Python</span></tt> should then take you to the <tt class="docutils literal"><span class="pre">Python</span></tt> detailed category view, as demonstrated in Figure <a class="pageref" href="#fig-rango-links">2</a>. If you see a list of links like <tt class="docutils literal"><span class="pre">Official</span> <span class="pre">Python</span> <span class="pre">Tutorial</span></tt>, then you&#8217;ve successfully set up the new view. Try navigating a category which doesn&#8217;t exist, like <tt class="docutils literal"><span class="pre">/rango/category/computers</span></tt>. You should see a message telling you that no pages exist in the category.</p>
<div class="align-center figure" id="fig-rango-links">
<img alt="../_images/rango-links.png" src="../_images/rango-links.png" />
<p class="caption">Figure 2: What your link structure should now look like. Starting with the Rango homepage, you are then presented with the category detail page. Clicking on a page link takes you to the linked website.</p>
</div>
</div>
</div>
<div class="section" id="exercises">
<h2>6.4. Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<p>Reinforce what you&#8217;ve learnt in this chapter by trying out the following exercises.</p>
<ul class="simple">
<li>Modify the index page to also include the top 5 most viewed pages.</li>
<li>The encoding and decoding of the Category name to a URL is not particularly robust as every time we need to access the page we need to decode the URL. One way we can make sure the encoding and decoding is to use some functions to perform the encoding and decoding.</li>
<li>While the encode and decode function help it is only part of the solution. How would you redesign the URL encoding so that it is more seamless and doesn&#8217;t require encoding and decoding every time?</li>
<li>Undertake the <a class="reference external" href="https://docs.djangoproject.com/en/1.5/intro/tutorial03/">part three of official Django tutorial</a> if you have not done so already to further what you&#8217;ve learnt here.</li>
</ul>
<div class="section" id="hints">
<h3>6.4.1. Hints<a class="headerlink" href="#hints" title="Permalink to this headline">¶</a></h3>
<p>To help you with the exercises above, the following hints may be of some use to you. Good luck!</p>
<ul class="simple">
<li>Update the population script to add some value to the views count for each page.</li>
<li>Create an encode and decode function to convert category_name_url to category_name and vice versa.</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        
        <li class="right" >
          <a href="forms.html" title="7. Fun with Forms"
             >next</a>
          </li>
		
        <li class="right" >
          <a href="models.html" title="5. Models and Databases"
             >previous</a>
          </li>
		
        <li><a href="../index-2.html">How to Tango with Django</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Leif Azzopardi and David Maxwell.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b2.
    </div>
  </body>

<!-- Mirrored from www.tangowithdjango.com/book/chapters/models_templates.html by HTTrack Website Copier/3.x [XR&CO'2008], Tue, 29 Oct 2013 17:08:05 GMT -->
</html>