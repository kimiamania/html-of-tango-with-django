<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  
<!-- Mirrored from www.tangowithdjango.com/book/chapters/login.html by HTTrack Website Copier/3.x [XR&CO'2008], Thu, 07 Nov 2013 01:42:35 GMT -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>8. User Authentication &mdash; How to Tango with Django</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/twd.ico"/>
    <link rel="top" title="How to Tango with Django" href="../index-2.html" />
    <link rel="next" title="9. Working with Templates" href="templates.html" />
    <link rel="prev" title="7. Fun with Forms" href="forms.html" />
 <style type="text/css">
	img{
	    width: 85%; /* you can use % */
	    height: auto;
	}
	
	table {
		margin: auto;
	}
	
	p.caption {
		font-size: 10pt;
		font-style: italic;
	}
 </style>
 <script type="text/javascript">

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','../../../www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44397330-1', 'tangowithdjango.com');
  ga('send', 'pageview');
     

  </script>      

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        
        <li class="right" >
          <a href="templates.html" title="9. Working with Templates"
             accesskey="N">next</a>
          </li>
		
        <li class="right" >
          <a href="forms.html" title="7. Fun with Forms"
             accesskey="P">previous</a>
          </li>
		
        <li><a href="../index-2.html">How to Tango with Django</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index-2.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">8. User Authentication</a><ul>
<li><a class="reference internal" href="#setting-up-authentication">8.1. Setting up Authentication</a></li>
<li><a class="reference internal" href="#the-user-model">8.2. The <tt class="docutils literal"><span class="pre">User</span></tt> Model</a></li>
<li><a class="reference internal" href="#additional-user-attributes">8.3. Additional User Attributes</a></li>
<li><a class="reference internal" href="#creating-a-user-registration-view-and-template">8.4. Creating a <em>User Registration</em> View and Template</a><ul>
<li><a class="reference internal" href="#creating-the-userform-and-userprofileform">8.4.1. Creating the <tt class="docutils literal"><span class="pre">UserForm</span></tt> and <tt class="docutils literal"><span class="pre">UserProfileForm</span></tt></a></li>
<li><a class="reference internal" href="#creating-the-register-view">8.4.2. Creating the <tt class="docutils literal"><span class="pre">register()</span></tt> View</a></li>
<li><a class="reference internal" href="#creating-the-registration-template">8.4.3. Creating the <em>Registration</em> Template</a></li>
<li><a class="reference internal" href="#the-register-view-url-mapping">8.4.4. The <tt class="docutils literal"><span class="pre">register()</span></tt> View URL Mapping</a></li>
<li><a class="reference internal" href="#linking-together">8.4.5. Linking Together</a></li>
<li><a class="reference internal" href="#demo">8.4.6. Demo</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-login-functionality">8.5. Adding Login Functionality</a><ul>
<li><a class="reference internal" href="#creating-the-login-view">8.5.1. Creating the <tt class="docutils literal"><span class="pre">login()</span></tt> View</a></li>
<li><a class="reference internal" href="#creating-a-login-template">8.5.2. Creating a <em>Login</em> Template</a></li>
<li><a class="reference internal" href="#mapping-the-login-view-to-a-url">8.5.3. Mapping the Login View to a URL</a></li>
<li><a class="reference internal" href="#id1">8.5.4. Linking Together</a></li>
<li><a class="reference internal" href="#id2">8.5.5. Demo</a></li>
</ul>
</li>
<li><a class="reference internal" href="#restricting-access">8.6. Restricting Access</a><ul>
<li><a class="reference internal" href="#restricting-access-with-a-decorator">8.6.1. Restricting Access with a Decorator</a></li>
</ul>
</li>
<li><a class="reference internal" href="#logging-out">8.7. Logging Out</a></li>
<li><a class="reference internal" href="#exercises">8.8. Exercises</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="forms.html"
                        title="previous chapter">7. Fun with Forms</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="templates.html"
                        title="next chapter">9. Working with Templates</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/chapters/login.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="http://www.tangowithdjango.com/book/search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="user-authentication">
<span id="login-label"></span><h1>8. User Authentication<a class="headerlink" href="#user-authentication" title="Permalink to this headline">¶</a></h1>
<p>The aim of this next part of the tutorial is to get you familiar with the user authentication mechanisms provided by Django. We&#8217;ll by using the <tt class="docutils literal"><span class="pre">auth</span></tt> application provided as part of a standard Django installation in package <tt class="docutils literal"><span class="pre">django.contrib.auth</span></tt>. According to <a class="reference external" href="https://docs.djangoproject.com/en/1.5/topics/auth/">Django&#8217;s official documentation on Authentication</a>, the application consists of the following aspects.</p>
<ul class="simple">
<li>Users.</li>
<li>Permissions: a series of binary flags (e.g. yes/no) determining what a user may or may not do.</li>
<li>Groups: a method of applying permissions to more than one user.</li>
<li>A configurable password hashing system: a must for ensuring data security.</li>
<li>Forms and view tools for logging in users, or restricting content.</li>
<li>A pluggable backend system.</li>
</ul>
<p>There&#8217;s lots that Django can do for you in the area of user authentication. We&#8217;ll be covering the basics to get your started.</p>
<div class="section" id="setting-up-authentication">
<h2>8.1. Setting up Authentication<a class="headerlink" href="#setting-up-authentication" title="Permalink to this headline">¶</a></h2>
<p>Before you can begin to play around with Django&#8217;s authentication offering, you&#8217;ll need to make sure that the relevant settings are present in your Rango project&#8217;s <tt class="docutils literal"><span class="pre">settings.py</span></tt> file.</p>
<p>Within the <tt class="docutils literal"><span class="pre">settings.py</span></tt> file find the <tt class="docutils literal"><span class="pre">INSTALLED_APPS</span></tt> tuple and check that <tt class="docutils literal"><span class="pre">django.contrib.auth</span></tt> and <tt class="docutils literal"><span class="pre">django.contrib.contenttypes</span></tt> are listed, so that it looks like the code below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span> <span class="c"># THIS LINE SHOULD BE PRESENT AND UNCOMMENTED</span>
    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span> <span class="c"># THIS LINE SHOULD BE PRESENT AND UNCOMMENTED</span>
    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sites&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="c"># Uncomment the next line to enable the admin:</span>
    <span class="s">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="c"># Uncomment the next line to enable admin documentation:</span>
    <span class="c"># &#39;django.contrib.admindocs&#39;,</span>
    <span class="s">&#39;rango&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>While <tt class="docutils literal"><span class="pre">django.contrib.auth</span></tt> provides Django with access to the authentication system, <tt class="docutils literal"><span class="pre">django.contrib.contenttypes</span></tt> is used by the authentication application to track models installed in your database.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Remember, if you had to add either one of the <tt class="docutils literal"><span class="pre">auth</span></tt> or <tt class="docutils literal"><span class="pre">contenttypes</span></tt> applications to your <tt class="docutils literal"><span class="pre">INSTALLED_APPS</span></tt> tuple, you will need to resynchronise your database with the <tt class="docutils literal"><span class="pre">$</span> <span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">syncdb</span></tt> command.</p>
</div>
<p>Passwords are stored by default in Django using the <a class="reference external" href="http://en.wikipedia.org/wiki/PBKDF2">PBKDF2 algorithm</a>, providing a good level of security for your user&#8217;s data. You can read more about this as part of the <a class="reference external" href="https://docs.djangoproject.com/en/1.5/topics/auth/passwords/#how-django-stores-passwords">official Django documentation on how django stores passwords</a>. The documentation also provides an explanation of how to use different password hashers if you require a greater level of security.</p>
</div>
<div class="section" id="the-user-model">
<h2>8.2. The <tt class="docutils literal"><span class="pre">User</span></tt> Model<a class="headerlink" href="#the-user-model" title="Permalink to this headline">¶</a></h2>
<p>The core of Django&#8217;s authentication system is the <tt class="docutils literal"><span class="pre">User</span></tt> object, located at <tt class="docutils literal"><span class="pre">django.contrib.auth.models.User</span></tt>. A <tt class="docutils literal"><span class="pre">User</span></tt> object represents each of the people interacting with a Django application. The <a class="reference external" href="https://docs.djangoproject.com/en/1.5/topics/auth/default/#user-objects">Django documentation on User objects</a> states that they are used to allow aspects of the authentication system like access restriction, registration of new user profiles and the association of creators with site content.</p>
<p>The <tt class="docutils literal"><span class="pre">User</span></tt> model comes complete with five primary attributes. They are:</p>
<ul class="simple">
<li>the username for the user account;</li>
<li>the account&#8217;s password;</li>
<li>the user&#8217;s email address;</li>
<li>the user&#8217;s first name; and</li>
<li>the user&#8217;s surname.</li>
</ul>
<p>The model also comes with other attributes such as <tt class="docutils literal"><span class="pre">is_active</span></tt> (which determines whether a particular account is active or not). Check the <a class="reference external" href="https://docs.djangoproject.com/en/1.5/ref/contrib/auth/#django.contrib.auth.models.User">official Django documentation on the user model</a> for a full list of attributes provided by the base <tt class="docutils literal"><span class="pre">User</span></tt> model.</p>
</div>
<div class="section" id="additional-user-attributes">
<h2>8.3. Additional User Attributes<a class="headerlink" href="#additional-user-attributes" title="Permalink to this headline">¶</a></h2>
<p>However, what if all the provided attributes that the <tt class="docutils literal"><span class="pre">User</span></tt> model provides isn&#8217;t enough? For our Rango application, we want to include two more additional attributes for each user account. Specifically, we wish to include:</p>
<ul class="simple">
<li>a <tt class="docutils literal"><span class="pre">URLField</span></tt>, allowing a user of Rango to specify their own website; and</li>
<li>a <tt class="docutils literal"><span class="pre">ImageField</span></tt>, which allows users to specify a picture for their user profile.</li>
</ul>
<p>Fortunately, this is a relatively easy task to accomplish. This is achieved through the creation of an additional model in Rango&#8217;s <tt class="docutils literal"><span class="pre">models.py</span></tt> file. Let&#8217;s add the new model - add the following code.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UserProfile</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># This line is required. Links UserProfile to a User model instance.</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>

    <span class="c"># The additional attributes we wish to include.</span>
    <span class="n">website</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">picture</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s">&#39;profile_images&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c"># Override the __unicode__() method to return out something meaningful!</span>
    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span>
</pre></div>
</div>
<p>As we also reference the <tt class="docutils literal"><span class="pre">User</span></tt> model, we&#8217;ll need to include the model into the <tt class="docutils literal"><span class="pre">models.py</span></tt> namespace. Add it with the following import statement at the top of the file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</pre></div>
</div>
<p>So, how do we accomplish our goal of adding additional user profile fields? This isn&#8217;t achieved through inheritance, instead the <tt class="docutils literal"><span class="pre">UserProfile</span></tt> model inherits from Django&#8217;s <tt class="docutils literal"><span class="pre">Model</span></tt> class and is linked to the base <tt class="docutils literal"><span class="pre">User</span></tt> class through a one-to-one relationship via attribute <tt class="docutils literal"><span class="pre">user</span></tt>. This is because various applications may all want to use the User model and extend upon it in different ways.</p>
<p>For Rango, we&#8217;ve added two fields to complete our user profile, and provided a <tt class="docutils literal"><span class="pre">__unicode__()</span></tt> method to return a meaningful value when a unicode representation of a <tt class="docutils literal"><span class="pre">UserProfile</span></tt> model instance is requested.</p>
<p>For the two fields <tt class="docutils literal"><span class="pre">website</span></tt> and <tt class="docutils literal"><span class="pre">picture</span></tt>, we have set <tt class="docutils literal"><span class="pre">blank=True</span></tt> for both. This allows each of the fields to be blank if necessary, meaning that users need not supply values for the attributes if they do not wish to.</p>
<p>Note that the <tt class="docutils literal"><span class="pre">ImageField</span></tt> field has an <tt class="docutils literal"><span class="pre">upload_to</span></tt> attribute. The value of this attribute is conjoined with the project&#8217;s <tt class="docutils literal"><span class="pre">MEDIA_ROOT</span></tt> setting to provide a path with which uploaded profile images will be stored. For example, a <tt class="docutils literal"><span class="pre">MEDIA_ROOT</span></tt> of <tt class="docutils literal"><span class="pre">&lt;workspace&gt;/tango_with_django_project/media/</span></tt> and <tt class="docutils literal"><span class="pre">upload_to</span></tt> attribute of <tt class="docutils literal"><span class="pre">profile_images</span></tt> will result in all profile images being stored in the directory <tt class="docutils literal"><span class="pre">&lt;workspace&gt;/tango_with_django_project/media/profile_images/</span></tt>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The Django <tt class="docutils literal"><span class="pre">ImageField</span></tt> field makes use of the <em>Python Imaging Library (PIL).</em> Back in Chapter <a class="reference internal" href="requirements.html#requirements-label">2</a>, we discussed installing PIL along with Django to your setup. If you haven&#8217;t got PIL installed, you&#8217;ll need to install it now. If you don&#8217;t, you&#8217;ll be greeted with exceptions stating that the module <tt class="docutils literal"><span class="pre">pil</span></tt> cannot be found!</p>
</div>
<p>With our <tt class="docutils literal"><span class="pre">UserProfile</span></tt> model defined, we now edit Rango&#8217;s <tt class="docutils literal"><span class="pre">admin.py</span></tt> file to include the new <tt class="docutils literal"><span class="pre">UserProfile</span></tt> model in the Django administration web interface. In the <tt class="docutils literal"><span class="pre">admin.py</span></tt> file, add the following line.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">UserProfile</span><span class="p">)</span>
</pre></div>
</div>
<p>You also need to import the <tt class="docutils literal"><span class="pre">UserProfile</span></tt> model by adding one of the following lines at the top of the <tt class="docutils literal"><span class="pre">admin.py</span></tt> file. Choose which one you like - the first imports <tt class="docutils literal"><span class="pre">UserProfile</span></tt> with a separate import statement, while the second combines the import of <tt class="docutils literal"><span class="pre">UserProfile</span></tt> with Rango models that we have used previously in <tt class="docutils literal"><span class="pre">admin.py</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Import the UserProfile model individually.</span>
<span class="kn">from</span> <span class="nn">rango.models</span> <span class="kn">import</span> <span class="n">UserProfile</span>

<span class="c"># Import the UserProfile model with Category and Page.</span>
<span class="c"># If you choose this option, you&#39;ll want to modify the import statement you&#39;ve already got to include UserProfile.</span>
<span class="kn">from</span> <span class="nn">rango.models</span> <span class="kn">import</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Page</span><span class="p">,</span> <span class="n">UserProfile</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Remember that with the creation of a new model, you must synchronise your database. Run <tt class="docutils literal"><span class="pre">$</span> <span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">syncb</span></tt> from your terminal to synchronise the new <tt class="docutils literal"><span class="pre">UserProfile</span></tt> model. Not doing so will result in errors explaining that the required database tables cannot be found.</p>
</div>
</div>
<div class="section" id="creating-a-user-registration-view-and-template">
<h2>8.4. Creating a <em>User Registration</em> View and Template<a class="headerlink" href="#creating-a-user-registration-view-and-template" title="Permalink to this headline">¶</a></h2>
<p>With our authentication infrastructure laid out, we can now begin to build onto it by providing users of our application with the opportunity to create new user accounts. We will achieve this via the creation of a new view and template combination.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We feel it&#8217;s important to note that there are several off-the-shelf user registration packages available for you to download and use in your Django projects. Examples include the <a class="reference external" href="https://bitbucket.org/ubernostrum/django-registration/">Django Registration application</a>, and you can also check out the table on <a class="reference external" href="https://www.djangopackages.com/grids/g/registration/">this webpage</a> which lists other registration packages. While these exist, we&#8217;ll be showing you how to set up everything from scratch. While this is at odds with the DRY principle, it is also important to get a feeling for the user authentication package and feature. It will also re-enforce your understanding of working with forms, how to extend upon the user model, and how to upload media.</p>
</div>
<p>To set everything the user registration functionality will we go through the following steps:</p>
<ol class="arabic simple">
<li>Create a <tt class="docutils literal"><span class="pre">UserForm</span></tt> and <tt class="docutils literal"><span class="pre">UserProfileForm</span></tt>.</li>
<li>Add a view to handle the creation of a new user.</li>
<li>Create a  template that displays the <tt class="docutils literal"><span class="pre">UserForm</span></tt> and <tt class="docutils literal"><span class="pre">UserProfileForm</span></tt>.</li>
<li>Map a URL to the view created.</li>
<li>Link the index page to the register page</li>
</ol>
<div class="section" id="creating-the-userform-and-userprofileform">
<span id="login-formclasses-label"></span><h3>8.4.1. Creating the <tt class="docutils literal"><span class="pre">UserForm</span></tt> and <tt class="docutils literal"><span class="pre">UserProfileForm</span></tt><a class="headerlink" href="#creating-the-userform-and-userprofileform" title="Permalink to this headline">¶</a></h3>
<p>In <tt class="docutils literal"><span class="pre">rango/forms.py</span></tt>, we now need to create two classes inheriting from <tt class="docutils literal"><span class="pre">forms.ModelForm</span></tt>. We&#8217;ll be creating one for the base <tt class="docutils literal"><span class="pre">User</span></tt> class, as well as one for the new <tt class="docutils literal"><span class="pre">UserProfile</span></tt> model that we just created. The two <tt class="docutils literal"><span class="pre">ModelForm</span></tt> inheriting classes allow us to display a HTML form displaying the necessary form fields for a particular model, taking away a significant amount of work for us. Neat!</p>
<p>In <tt class="docutils literal"><span class="pre">rango/forms.py</span></tt>, let&#8217;s create our two classes which inherit from <tt class="docutils literal"><span class="pre">forms.ModelForm</span></tt>. Add the following code to the module.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UserForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">())</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;username&#39;</span><span class="p">,</span> <span class="s">&#39;email&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">UserProfileForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">UserProfile</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;website&#39;</span><span class="p">,</span> <span class="s">&#39;picture&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You&#8217;ll notice that within both classes we create, we add a <a class="reference external" href="http://www.brpreiss.com/books/opus7/html/page598.html">nested</a> <tt class="docutils literal"><span class="pre">Meta</span></tt> class. As <a class="reference external" href="http://www.webopedia.com/TERM/M/meta.html">the name of the nested class may suggest</a>, anything within a nested <tt class="docutils literal"><span class="pre">Meta</span></tt> class describes additional properties about the particular <tt class="docutils literal"><span class="pre">ModelForm</span></tt> class it belongs to. Each <tt class="docutils literal"><span class="pre">Meta</span></tt> class must at a bare minimum supply a <tt class="docutils literal"><span class="pre">model</span></tt> field, which references back to the model the <tt class="docutils literal"><span class="pre">ModelForm</span></tt> inheriting class should relate to. Our <tt class="docutils literal"><span class="pre">UserForm</span></tt> class is therefore associated with the <tt class="docutils literal"><span class="pre">User</span></tt> model, for example. By default, Django then renders a HTML form for <em>all</em> fields within the associated model.</p>
<p>However, there may be scenarios where we would not want a user to provide information for <em>all</em> fields within the associated model. For example, certain form fields may need to be filled in automatically by your code - such as in the <tt class="docutils literal"><span class="pre">UserProfileForm</span></tt>. Recall that the <tt class="docutils literal"><span class="pre">UserProfile</span></tt> model contains a <tt class="docutils literal"><span class="pre">user</span></tt> attribute, providing a one-to-one relationship to the <tt class="docutils literal"><span class="pre">User</span></tt> model. We don&#8217;t want users to see this abstraction - we want Rango to handle it for them! With the <tt class="docutils literal"><span class="pre">fields</span></tt> attribute, we can fine tune what fields the user sees in a rendered form. <tt class="docutils literal"><span class="pre">UserProfileForm</span></tt> will therefore display entries for the <tt class="docutils literal"><span class="pre">website</span></tt> and <tt class="docutils literal"><span class="pre">picture</span></tt> fields, but will not provide anything for the <tt class="docutils literal"><span class="pre">user</span></tt> field.</p>
<p>You&#8217;ll also notice that <tt class="docutils literal"><span class="pre">UserForm</span></tt> includes a definition of the <tt class="docutils literal"><span class="pre">password</span></tt> attribute. While a <tt class="docutils literal"><span class="pre">User</span></tt> model instance contains a <tt class="docutils literal"><span class="pre">password</span></tt> attribute by default, the rendered HTML form element is of the incorrect type. If a user types a password, the password will be visible. By updating the <tt class="docutils literal"><span class="pre">password</span></tt> attribute definition, we can then specify that the <tt class="docutils literal"><span class="pre">CharField</span></tt> instance should hide a user&#8217;s input from prying eyes through use of the <tt class="docutils literal"><span class="pre">PasswordInput()</span></tt> widget.</p>
<p>You shouldn&#8217;t forget to include the required classes at the top of the <tt class="docutils literal"><span class="pre">forms.py</span></tt> module!</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">rango.models</span> <span class="kn">import</span> <span class="n">UserProfile</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-the-register-view">
<h3>8.4.2. Creating the <tt class="docutils literal"><span class="pre">register()</span></tt> View<a class="headerlink" href="#creating-the-register-view" title="Permalink to this headline">¶</a></h3>
<p>Next we need to handle both the rendering of the form, and the processing of form input data. Within Rango&#8217;s <tt class="docutils literal"><span class="pre">views.py</span></tt> file, add the following view function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">rango.forms</span> <span class="kn">import</span> <span class="n">UserForm</span><span class="p">,</span> <span class="n">UserProfileForm</span>

<span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c"># Like before, get the request&#39;s context.</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="c"># A boolean value for telling the template whether the registration was successful.</span>
    <span class="c"># Set to False initially. Code changes value to True when registration succeeds.</span>
    <span class="n">registered</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c"># If it&#39;s a HTTP POST, we&#39;re interested in processing form data.</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="c"># Attempt to grab information from the raw form information.</span>
        <span class="c"># Note that we make use of both UserForm and UserProfileForm.</span>
        <span class="n">user_form</span> <span class="o">=</span> <span class="n">UserForm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="n">profile_form</span> <span class="o">=</span> <span class="n">UserProfileForm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

        <span class="c"># If the two forms are valid...</span>
        <span class="k">if</span> <span class="n">user_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span> <span class="ow">and</span> <span class="n">profile_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="c"># Save the user&#39;s form data to the database.</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">user_form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="c"># Now we hash the password with the set_password method.</span>
            <span class="c"># Once hashed, we can update the user object.</span>
            <span class="n">user</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
            <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="c"># Now sort out the UserProfile instance.</span>
            <span class="c"># Since we need to set the user attribute ourselves, we set commit=False.</span>
            <span class="c"># This delays saving the model until we&#39;re ready to avoid integrity problems.</span>
            <span class="n">profile</span> <span class="o">=</span> <span class="n">profile_form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">profile</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>

            <span class="c"># Did the user provide a profile picture?</span>
            <span class="c"># If so, we need to get it from the input form and put it in the UserProfile model.</span>
            <span class="k">if</span> <span class="s">&#39;picture&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">:</span>
                <span class="n">profile</span><span class="o">.</span><span class="n">picture</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">[</span><span class="s">&#39;picture&#39;</span><span class="p">]</span>

            <span class="c"># Now we save the UserProfile model instance.</span>
            <span class="n">profile</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="c"># Update our variable to tell the template registration was successful.</span>
            <span class="n">registered</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c"># Invalid form or forms - mistakes or something else?</span>
        <span class="c"># Print problems to the terminal.</span>
        <span class="c"># They&#39;ll also be shown to the user.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">user_form</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="n">profile_form</span><span class="o">.</span><span class="n">errors</span>

    <span class="c"># Not a HTTP POST, so we render our form using two ModelForm instances.</span>
    <span class="c"># These forms will be blank, ready for user input.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">user_form</span> <span class="o">=</span> <span class="n">UserForm</span><span class="p">()</span>
        <span class="n">profile_form</span> <span class="o">=</span> <span class="n">UserProfileForm</span><span class="p">()</span>

    <span class="c"># Render the template depending on the context.</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span>
            <span class="s">&#39;rango/register.html&#39;</span><span class="p">,</span>
            <span class="p">{</span><span class="s">&#39;user_form&#39;</span><span class="p">:</span> <span class="n">user_form</span><span class="p">,</span> <span class="s">&#39;profile_form&#39;</span><span class="p">:</span> <span class="n">profile_form</span><span class="p">,</span> <span class="s">&#39;registered&#39;</span><span class="p">:</span> <span class="n">registered</span><span class="p">},</span>
            <span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<p>Is the view a lot more complex? It might look so at first, but it isn&#8217;t really. The only added complexity from our previous <tt class="docutils literal"><span class="pre">add_category()</span></tt> view is the need to handle two distinct <tt class="docutils literal"><span class="pre">ModelForm</span></tt> instances - one for the <tt class="docutils literal"><span class="pre">User</span></tt> model, and one for the <tt class="docutils literal"><span class="pre">UserProfile</span></tt> model. We also need to handle a user&#8217;s profile image, if he or she chooses to upload one.</p>
<p>We also establish a link between the two model instances that we create. After creating a new <tt class="docutils literal"><span class="pre">User</span></tt> model instance, we reference it in the <tt class="docutils literal"><span class="pre">UserProfile</span></tt> instance with the line <tt class="docutils literal"><span class="pre">profile.user</span> <span class="pre">=</span> <span class="pre">user</span></tt>. This is where we populate the <tt class="docutils literal"><span class="pre">user</span></tt> attribute of the <tt class="docutils literal"><span class="pre">UserProfileForm</span></tt> form, which we hid from users in Section <a class="reference internal" href="#login-formclasses-label">8.4.1</a>.</p>
</div>
<div class="section" id="creating-the-registration-template">
<h3>8.4.3. Creating the <em>Registration</em> Template<a class="headerlink" href="#creating-the-registration-template" title="Permalink to this headline">¶</a></h3>
<p>Now create a new template file, <tt class="docutils literal"><span class="pre">rango/register.html</span></tt> and add the following code:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>Rango<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>

    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;h1&gt;</span>Register with Rango<span class="nt">&lt;/h1&gt;</span>

        {% if registered %}
        Rango says: <span class="nt">&lt;strong&gt;</span>thank you for registering!<span class="nt">&lt;/strong&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/rango/&quot;</span><span class="nt">&gt;</span>Return to the homepage.<span class="nt">&lt;/a&gt;&lt;br</span> <span class="nt">/&gt;</span>
        {% else %}
        Rango says: <span class="nt">&lt;strong&gt;</span>register here!<span class="nt">&lt;/strong&gt;&lt;br</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">&quot;user_form&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">action=</span><span class="s">&quot;/rango/register/&quot;</span>
                <span class="na">enctype=</span><span class="s">&quot;multipart/form-data&quot;</span><span class="nt">&gt;</span>

            {% csrf_token %}

            <span class="c">&lt;!-- Display each form. The as.p method wraps each element in a paragraph</span>
<span class="c">                 (&lt;p&gt;) element. This ensures each element appears on a new line,</span>
<span class="c">                 making everything look neater. --&gt;</span>
            {{ user_form.as_p }}
            {{ profile_form.as_p }}

            <span class="c">&lt;!-- Provide a button to click to submit the form. --&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">name=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Register&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
        {% endif %}
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>This HTML template makes use of the <tt class="docutils literal"><span class="pre">register</span></tt> variable we used in our view indicating whether registration was successful or not. Note that <tt class="docutils literal"><span class="pre">registered</span></tt> must be <tt class="docutils literal"><span class="pre">False</span></tt> in order for the template to display the registration form - otherwise, apart from the title, only a success message is displayed.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>You should be aware of the <tt class="docutils literal"><span class="pre">enctype</span></tt> attribute for the <tt class="docutils literal"><span class="pre">&lt;form&gt;</span></tt> element. When you want users to upload files, you <strong>need</strong> to set <tt class="docutils literal"><span class="pre">enctype</span></tt> to <tt class="docutils literal"><span class="pre">multipart/form-data</span></tt>. This is because the browser needs to encode the data in a number of chunks in order to send the file.</p>
<p class="last">Also, remember to make sure you include the CSRF token too <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">csrf_token</span> <span class="pre">%}</span></tt>.</p>
</div>
</div>
<div class="section" id="the-register-view-url-mapping">
<h3>8.4.4. The <tt class="docutils literal"><span class="pre">register()</span></tt> View URL Mapping<a class="headerlink" href="#the-register-view-url-mapping" title="Permalink to this headline">¶</a></h3>
<p>Now we can add a URL mapping to our new view. In <tt class="docutils literal"><span class="pre">rango/urls.py</span></tt> modify the <tt class="docutils literal"><span class="pre">urlpatterns</span></tt> tuple as shown below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;index&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^about/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">about</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;about&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^category/(?P&lt;category_name_url&gt;\w+)$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;category&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^add_category/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">add_category</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;add_category&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^category/(?P&lt;category_name_url&gt;\w+)/add_page/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">add_page</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;add_page&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^register/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">register</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;register&#39;</span><span class="p">),</span> <span class="c"># ADD NEW PATTERN!</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>The newly added pattern points the URL <tt class="docutils literal"><span class="pre">/rango/register/</span></tt> to the <tt class="docutils literal"><span class="pre">register()</span></tt> view.</p>
</div>
<div class="section" id="linking-together">
<h3>8.4.5. Linking Together<a class="headerlink" href="#linking-together" title="Permalink to this headline">¶</a></h3>
<p>Finally, we can add a link pointing to that URL in our homepage <tt class="docutils literal"><span class="pre">index.html</span></tt> template. Underneath the link to the category addition page, add the following hyperlink.</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/rango/register/&quot;</span><span class="nt">&gt;</span>Register Here<span class="nt">&lt;/a&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="demo">
<h3>8.4.6. Demo<a class="headerlink" href="#demo" title="Permalink to this headline">¶</a></h3>
<p>Easy! Now you&#8217;ll have a new hyperlink with the text <tt class="docutils literal"><span class="pre">Register</span> <span class="pre">Here</span></tt> that&#8217;ll take you to the registration page. Try it out now! Start your Django development server and try to register a new user account. Upload a profile image if you wish. Your registration form should look like the one illustrated in Figure <a class="pageref" href="#fig-rango-register-form">1</a>.</p>
<div class="align-center figure" id="fig-rango-register-form">
<img alt="../_images/rango-register-form.png" src="../_images/rango-register-form.png" />
<p class="caption">Figure 1: A screenshot illustrating the basic registration form you create as part of this tutorial.</p>
</div>
<p>Upon seeing the message indicating your details were successfully registered, the database should have two new entries in its tables corresponding to the <tt class="docutils literal"><span class="pre">User</span></tt> and <tt class="docutils literal"><span class="pre">UserProfile</span></tt> models.</p>
</div>
</div>
<div class="section" id="adding-login-functionality">
<h2>8.5. Adding Login Functionality<a class="headerlink" href="#adding-login-functionality" title="Permalink to this headline">¶</a></h2>
<p>With the ability to register accounts completed, we now need to add login in functionality. To achieve this we will need to undertake the workflow below:</p>
<ul class="simple">
<li>Create a login in view to handle user credentials</li>
<li>Create a login template to display the login form</li>
<li>Map the login view to a url</li>
<li>Provide a link to login from the index page</li>
</ul>
<div class="section" id="creating-the-login-view">
<h3>8.5.1. Creating the <tt class="docutils literal"><span class="pre">login()</span></tt> View<a class="headerlink" href="#creating-the-login-view" title="Permalink to this headline">¶</a></h3>
<p>In <tt class="docutils literal"><span class="pre">rango/views.py</span></tt> create a new function called <tt class="docutils literal"><span class="pre">user_login()</span></tt> and add the following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">user_login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c"># Like before, obtain the context for the user&#39;s request.</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="c"># If the request is a HTTP POST, try to pull out the relevant information.</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="c"># Gather the username and password provided by the user.</span>
        <span class="c"># This information is obtained from the login form.</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">]</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">]</span>

        <span class="c"># Use Django&#39;s machinery to attempt to see if the username/password</span>
        <span class="c"># combination is valid - a User object is returned if it is.</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>

        <span class="c"># If we have a User object, the details are correct.</span>
        <span class="c"># If None (Python&#39;s way of representing the absence of a value), no user</span>
        <span class="c"># with matching credentials was found.</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Is the account active? It could have been disabled.</span>
            <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
                <span class="c"># If the account is valid and active, we can log the user in.</span>
                <span class="c"># We&#39;ll send the user back to the homepage.</span>
                <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/rango/&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># An inactive account was used - no logging in!</span>
                <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;Your Rango account is disabled.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Bad login details were provided. So we can&#39;t log the user in.</span>
            <span class="k">print</span> <span class="s">&quot;Invalid login details: {0}, {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;Invalid login details supplied.&quot;</span><span class="p">)</span>

    <span class="c"># The request is not a HTTP POST, so display the login form.</span>
    <span class="c"># This scenario would most likely be a HTTP GET.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># No context variables to pass to the template system, hence the</span>
        <span class="c"># blank dictionary object...</span>
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;rango/login.html&#39;</span><span class="p">,</span> <span class="p">{},</span> <span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<p>This view may seem rather complicated as it has to handle a variety of situations. Like in previous examples before, the <tt class="docutils literal"><span class="pre">user_login()</span></tt> view handles form rendering and processing.</p>
<p>First, if the view is accessed via the HTTP GET method, then the login form is displayed. However, if the form has been posted via the HTTP POST method, then we can handle processing the form.</p>
<p>If a valid form is sent, the username and password are extracted from the form. These details are then used to attempt to authenticate the user (with Django&#8217;s <tt class="docutils literal"><span class="pre">authenticate()</span></tt> function). <tt class="docutils literal"><span class="pre">authenticate()</span></tt> then returns a <tt class="docutils literal"><span class="pre">User</span></tt> object if the username/password combination exists within the database - or <tt class="docutils literal"><span class="pre">None</span></tt> if no match was found.</p>
<p>If we retrieve a <tt class="docutils literal"><span class="pre">User</span></tt> object, we can then check if the account is active or inactive - and return the appropriate response to the client&#8217;s browser.</p>
<p>However, if an invalid form is sent, because the user did not add both a username and password the login form is presented back to the user will form error messages (i.e. username/password is missing).</p>
<p>Of particular interest in the code sample above is the use of the built-in Django machinery to help with the authentication process. Note the use of the <tt class="docutils literal"><span class="pre">authenticate()</span></tt> function to check whether the username and password provided match to a valid user account, and the <tt class="docutils literal"><span class="pre">login()</span></tt> function to signify to Django that the user is to be logged in.</p>
<p>You&#8217;ll also notice that we make use of a new class, <tt class="docutils literal"><span class="pre">HttpResponseRedirect</span></tt>. As the name may suggest to you, the response generated by an instance of the <tt class="docutils literal"><span class="pre">HttpResponseRedirect</span></tt> class tells the client&#8217;s browser to redirect to the URL you provide as the argument. Note that this will return a HTTP status code of 302, which denotes a redirect, as opposed to an status code of 200 i.e. OK. See the <a class="reference external" href="https://docs.djangoproject.com/en/1.5/ref/request-response/#django.http.HttpResponseRedirect">official Django documentation  on Redirection</a>, to learn more.</p>
<p>All of these functions and classes are provided by Django, and as such you&#8217;ll need to import them, so add the following imports to <tt class="docutils literal"><span class="pre">rango/views.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">authenticate</span><span class="p">,</span> <span class="n">login</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponseRedirect</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-login-template">
<h3>8.5.2. Creating a <em>Login</em> Template<a class="headerlink" href="#creating-a-login-template" title="Permalink to this headline">¶</a></h3>
<p>With our new view created, we&#8217;ll need to create a new template allowing users to login. While we know that the template will live in the <tt class="docutils literal"><span class="pre">templates/rango/</span></tt> directory, we&#8217;ll leave you to figure out the name of the file. Look at the code example above to work out the name. In your new template file, add the following code:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="c">&lt;!-- Is anyone getting tired of repeatedly entering the header over and over?? --&gt;</span>
        <span class="nt">&lt;title&gt;</span>Rango<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>

    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;h1&gt;</span>Login to Rango<span class="nt">&lt;/h1&gt;</span>

        <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">&quot;login_form&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">action=</span><span class="s">&quot;/rango/login/&quot;</span><span class="nt">&gt;</span>
            {% csrf_token %}
            Username: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">value=</span><span class="s">&quot;&quot;</span> <span class="na">size=</span><span class="s">&quot;50&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;br</span> <span class="nt">/&gt;</span>
            Password: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">value=</span><span class="s">&quot;&quot;</span> <span class="na">size=</span><span class="s">&quot;50&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;br</span> <span class="nt">/&gt;</span>

            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;submit&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/form&gt;</span>

    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>Ensure that you match up the input <tt class="docutils literal"><span class="pre">name</span></tt> attributes to those that you specified in the <tt class="docutils literal"><span class="pre">user_login()</span></tt> view - i.e. <tt class="docutils literal"><span class="pre">username</span></tt> for the username, and <tt class="docutils literal"><span class="pre">password</span></tt> for password. Don&#8217;t forget the <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">csrf_token</span> <span class="pre">%}</span></tt>, either!</p>
</div>
<div class="section" id="mapping-the-login-view-to-a-url">
<h3>8.5.3. Mapping the Login View to a URL<a class="headerlink" href="#mapping-the-login-view-to-a-url" title="Permalink to this headline">¶</a></h3>
<p>With your login template created, we can now match up the <tt class="docutils literal"><span class="pre">user_login()</span></tt> view to a URL. Modify Rango&#8217;s <tt class="docutils literal"><span class="pre">urls.py</span></tt> file so that its <tt class="docutils literal"><span class="pre">urlpatterns</span></tt> tuple now looks like the code below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;index&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^about/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">about</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;about&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^category/(?P&lt;category_name_url&gt;\w+)$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;category&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^add_category/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">add_category</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;add_category&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^category/(?P&lt;category_name_url&gt;\w+)/add_page/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">add_page</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;add_page&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^register/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">register</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;register&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^login/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">user_login</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;login&#39;</span><span class="p">),</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h3>8.5.4. Linking Together<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Our final step is to provide users of Rango with a handy link to access the login page. To do this, we&#8217;ll edit the <tt class="docutils literal"><span class="pre">index.html</span></tt> template inside of the <tt class="docutils literal"><span class="pre">templates/rango/</span></tt> directory. Find the previously created category addition and registration links, and add the following hyperlink underneath. You may wish to include a line break (<tt class="docutils literal"><span class="pre">&lt;br</span> <span class="pre">/&gt;</span></tt>) before the link.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">&quot;/rango/login/&quot;</span><span class="o">&gt;</span><span class="n">Login</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>If you like, you can also modify the header of the index page to provide a personalised message if a user is logged in, and a more generic message if the user isn&#8217;t. Within the <tt class="docutils literal"><span class="pre">index.html</span></tt> template, find the header, as shown in the code snippet below.</p>
<div class="highlight-python"><pre>&lt;h1&gt;Rango says..hello world!&lt;/h1&gt;</pre>
</div>
<p>Replace this header with the following markup and Django template code. Note that we make use of the <tt class="docutils literal"><span class="pre">user</span></tt> object, which is available to Django&#8217;s template system via the context. We can tell from this object if the user is logged in (authenticated). If he or she is logged in, we can also obtain details about him or her.</p>
<div class="highlight-python"><pre>{% if user.is_authenticated %}
&lt;h1&gt;Rango says... hello {{ user.username }}!&lt;/h1&gt;
{% else %}
&lt;h1&gt;Rango says... hello world!&lt;/h1&gt;
{% endif %}</pre>
</div>
<p>As you can see we have used  Django&#8217;s Template Language to check if the user is authenticated with <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">user.is_authenticated</span> <span class="pre">%}</span></tt>. The context variable which we pass through to the template will include a user variable if the user is logged in - so we can check whether they are authenticated or not. If so they will receive a personalised greeting in the header, i.e. <tt class="docutils literal"><span class="pre">Rango</span> <span class="pre">says...</span> <span class="pre">hello</span> <span class="pre">leifos!</span></tt>. Otherwise, the generic <tt class="docutils literal"><span class="pre">Rango</span> <span class="pre">says...</span> <span class="pre">hello</span> <span class="pre">world!</span></tt> header is displayed.</p>
</div>
<div class="section" id="id2">
<h3>8.5.5. Demo<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Check out Figure <a class="pageref" href="#fig-rango-login-message">2</a> for screenshots of what everything should look like.</p>
<div class="align-center figure" id="fig-rango-login-message">
<img alt="../_images/rango-login-message.png" src="../_images/rango-login-message.png" />
<p class="caption">Figure 2: Screenshots illustrating the header users receive when not logged in, and logged in with username <tt class="docutils literal"><span class="pre">somebody</span></tt>.</p>
</div>
<p>With this completed, user logins should now be completed! To test everything out, try starting Django&#8217;s development server and attempt to register a new account. After successful registration, you should then be able to login with the details you just provided.</p>
</div>
</div>
<div class="section" id="restricting-access">
<h2>8.6. Restricting Access<a class="headerlink" href="#restricting-access" title="Permalink to this headline">¶</a></h2>
<p>Now that users can login to Rango, we can now go about restricting access to particular parts of the application as per the specification, i.e. that only registered users can add categories and pages. With Django, there are two ways in which we can achieve this goal:</p>
<ul class="simple">
<li>directly, by examining the <tt class="docutils literal"><span class="pre">request</span></tt> object and check if the user is authenticated, or,</li>
<li>using a convenience <em>decorator</em> function that check if the user is authenticated.</li>
</ul>
<p>The direct approach checks to see whether a user is logged in, via the <tt class="docutils literal"><span class="pre">user.is_authenticated()</span></tt> method. The <tt class="docutils literal"><span class="pre">user</span></tt> object is available via the <tt class="docutils literal"><span class="pre">request</span></tt> object passed into a view. The following example demonstrates this approach.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">some_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;You are logged in.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;You are not logged in.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The second approach uses <a class="reference external" href="http://wiki.python.org/moin/PythonDecorators">Python decorators</a>. Decorators are named after a <a class="reference external" href="http://en.wikipedia.org/wiki/Decorator_pattern">software design pattern by the same name</a>. They can dynamically alter the functionality of a function, method or class without having to directly edit the source code of the given function, method or class.</p>
<p>Django provides decorator called, <tt class="docutils literal"><span class="pre">login_required()</span></tt> which we can attach to any view, where we require the user to be logged in. If a user is not logged in and they try to access a page which calls that view, then the user is redirected to another page which you can set, typically the login page.</p>
<div class="section" id="restricting-access-with-a-decorator">
<h3>8.6.1. Restricting Access with a Decorator<a class="headerlink" href="#restricting-access-with-a-decorator" title="Permalink to this headline">¶</a></h3>
<p>To try this out,  create a view in Rango&#8217;s <tt class="docutils literal"><span class="pre">views.py</span></tt> file, called <tt class="docutils literal"><span class="pre">restricted()</span></tt> and add the following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">restricted</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;Since you&#39;re logged in, you can see this text!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that to use a decorator, you place it <em>directly above</em> the function signature, and put a <tt class="docutils literal"><span class="pre">&#64;</span></tt> before naming the decorator. Python will execute the decorator before executing the code of your function/method. To use the decorator you will have to import it, so also add the following import:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>
</pre></div>
</div>
<p>We&#8217;ll also add in another pattern to Rango&#8217;s <tt class="docutils literal"><span class="pre">urlpatterns</span></tt> tuple in the <tt class="docutils literal"><span class="pre">urls.py</span></tt> file. Our tuple should then look something like the following example. Note the inclusion of mapping of the <tt class="docutils literal"><span class="pre">views.restricted</span></tt> view - this is the mapping you need to add.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;index&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^add_category/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">add_category</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;add_category&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^register/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">register</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;register&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^login/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">user_login</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;login&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^restricted/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">restricted</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;restricted&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^(?P&lt;category_name_url&gt;\w+)&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;category&#39;</span><span class="p">),)</span>
</pre></div>
</div>
<p>We&#8217;ll also need to handle the scenario where a user attempts to access the <tt class="docutils literal"><span class="pre">restricted()</span></tt> view, but is not logged in. What do we do with the user? The simplest approach is to redirect his or her browser. Django allows us to specify this in our project&#8217;s <tt class="docutils literal"><span class="pre">settings.py</span></tt> file, located in the project configuration directory. In <tt class="docutils literal"><span class="pre">settings.py</span></tt>, define the variable <tt class="docutils literal"><span class="pre">LOGIN_URL</span></tt> with the URL you&#8217;d like to redirect users to that aren&#8217;t logged in, i.e. the login page located at <tt class="docutils literal"><span class="pre">/rango/login/</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">LOGIN_URL</span> <span class="o">=</span> <span class="s">&#39;/rango/login/&#39;</span>
</pre></div>
</div>
<p>This ensures that the <tt class="docutils literal"><span class="pre">login_required()</span></tt> decorator will redirect any user not logged in to the URL <tt class="docutils literal"><span class="pre">/rango/login/</span></tt>.</p>
</div>
</div>
<div class="section" id="logging-out">
<h2>8.7. Logging Out<a class="headerlink" href="#logging-out" title="Permalink to this headline">¶</a></h2>
<p>To enable users to log out gracefully it would be nice to provide a logout option to users. Django comes with a handy <tt class="docutils literal"><span class="pre">logout()</span></tt> function that take cares of ensuring that the user is logged out, that their session is ended, and that if they subsequent try to access a view, that it will deny them access.</p>
<p>To provide log out functionality in <tt class="docutils literal"><span class="pre">rango/views.py</span></tt> add the a view called <tt class="docutils literal"><span class="pre">user_logout()</span></tt> with the following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">logout</span>

<span class="c"># Use the login_required() decorator to ensure only those logged in can access the view.</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">user_logout</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c"># Since we know the user is logged in, we can now just log them out.</span>
    <span class="n">logout</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="c"># Take the user back to the homepage.</span>
    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/rango/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Where&#8217;s <tt class="docutils literal"><span class="pre">RequestContext()</span></tt>? In this simple user logout view, there&#8217;s no need to obtain the request&#8217;s context from Django&#8217;s backend. If we don&#8217;t need it, why ask for it?</p>
</div>
<p>With the view created, map the URL <tt class="docutils literal"><span class="pre">/rango/logout/</span></tt> to the <tt class="docutils literal"><span class="pre">user_logout()</span></tt> view by modifying the <tt class="docutils literal"><span class="pre">urlpatterns</span></tt> tuple in Rango&#8217;s <tt class="docutils literal"><span class="pre">urls.py</span></tt> module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;index&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^about/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">about</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;about&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^category/(?P&lt;category_name_url&gt;\w+)$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;category&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^add_category/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">add_category</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;add_category&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^category/(?P&lt;category_name_url&gt;\w+)/add_page/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">add_page</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;add_page&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^register/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">register</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;register&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^login/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">user_login</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;login&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^restricted/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">restricted</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;restricted&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^logout/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">user_logout</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;logout&#39;</span><span class="p">),</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Now that all the machinery for logging a user out has been completed, it&#8217;d be handy to provide a link from the homepage to allow users to simply click a link to logout. However, let&#8217;s be smart about this: is there any point providing the logout link to a user who isn&#8217;t logged in? Perhaps not - it may be more beneficial for a user who isn&#8217;t logged in to be given the chance to register, for example.</p>
<p>Like in the previous section, we&#8217;ll be modifying Rango&#8217;s <tt class="docutils literal"><span class="pre">index.html</span></tt> template, and making use of the <tt class="docutils literal"><span class="pre">user</span></tt> object in the template&#8217;s context to determine what links we want to show. Find your growing list of links at the bottom of the page and replace it with the following HTML markup and Django template code. Note we also add a link to our restricted page at <tt class="docutils literal"><span class="pre">/rango/restricted/</span></tt>.</p>
<div class="highlight-html"><div class="highlight"><pre>{% if user.is_authenticated %}
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/rango/restricted/&quot;</span><span class="nt">&gt;</span>Restricted Page<span class="nt">&lt;/a&gt;&lt;br</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/rango/logout/&quot;</span><span class="nt">&gt;</span>Logout<span class="nt">&lt;/a&gt;&lt;br</span> <span class="nt">/&gt;</span>
{% else %}
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/rango/register/&quot;</span><span class="nt">&gt;</span>Register Here<span class="nt">&lt;/a&gt;&lt;br</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/rango/login/&quot;</span><span class="nt">&gt;</span>Login<span class="nt">&lt;/a&gt;&lt;br</span> <span class="nt">/&gt;</span>
{% endif %}

<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/rango/about/&quot;</span><span class="nt">&gt;</span>About<span class="nt">&lt;/a&gt;&lt;br/&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/rango/add_category/&quot;</span><span class="nt">&gt;</span>Add a New Category<span class="nt">&lt;/a&gt;&lt;br</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Simple - when a user is authenticated and logged in, he or she can see the <tt class="docutils literal"><span class="pre">Restricted</span> <span class="pre">Page</span></tt> and <tt class="docutils literal"><span class="pre">Logout</span></tt> links. If he or she isn&#8217;t logged in, <tt class="docutils literal"><span class="pre">Register</span> <span class="pre">Here</span></tt> and <tt class="docutils literal"><span class="pre">Login</span></tt> are presented. As <tt class="docutils literal"><span class="pre">About</span></tt> and <tt class="docutils literal"><span class="pre">Add</span> <span class="pre">a</span> <span class="pre">New</span> <span class="pre">Category</span></tt> are not within the template conditional blocks, these links are available to both anonymous and logged in users.</p>
</div>
<div class="section" id="exercises">
<h2>8.8. Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<p>This chapter has covered several important aspects of managing user authentication within Django. We&#8217;ve covered the basics of installing Django&#8217;s <tt class="docutils literal"><span class="pre">django.contrib.auth</span></tt> application into our project. Additionally, we have also shown how to implement a user profile model that can provide additional fields to the base <tt class="docutils literal"><span class="pre">django.contrib.auth.models.User</span></tt> model. We have also detailed how to setup the functionality to allow user registrations, login, logout, and to control access. For more information about user authentication and registration consult  <a class="reference external" href="https://docs.djangoproject.com/en/1.5/topics/auth/">Django&#8217;s official documentation on Authentication</a>.</p>
<ul class="simple">
<li>Customise the application so that only registered users can add/edit, while non-registered can only view/use the categories/pages. You&#8217;ll also have ensure links to add/edit pages appear only if the user browsing the website is logged in.</li>
<li>Provide informative error messages when users incorrectly enter their username or password.</li>
</ul>
<p>In most applications you are going to require different levels of security when registering and managing users - for example, making sure the user enters an email address that they have access to, or sending users passwords that they have forgotten. While we could extend the current approach and build all the necessary infrastructure to support such functionality a <tt class="docutils literal"><span class="pre">django-registration</span></tt> application has been developed which greatly simplifies the process - visit <a class="reference external" href="https://django-registration.readthedocs.org/en/latest/">https://django-registration.readthedocs.org/en/latest/</a> to find out more about using this package.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        
        <li class="right" >
          <a href="templates.html" title="9. Working with Templates"
             >next</a>
          </li>
		
        <li class="right" >
          <a href="forms.html" title="7. Fun with Forms"
             >previous</a>
          </li>
		
        <li><a href="../index-2.html">How to Tango with Django</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Leif Azzopardi and David Maxwell.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b2.
    </div>
  </body>

<!-- Mirrored from www.tangowithdjango.com/book/chapters/login.html by HTTrack Website Copier/3.x [XR&CO'2008], Thu, 07 Nov 2013 01:42:35 GMT -->
</html>